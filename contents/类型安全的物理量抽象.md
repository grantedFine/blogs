#### 物理量单位的抽象

物理量单位由七种基本单位和导出单位组成，可以抽象为：m^x1 * kg ^ x2 * ... * cd ^ x7, 其中，x1...x7是有理数。考虑到类型安全，使用泛型来定义物理量单位的类型。

```ts
class Unit<
    Tm extends number,
    Tkg extends number,
    Ts extends number,
    TA extends number,
    TK extends number,
    Tmol extends number,
    Tcd extends number> {
    constructor(
        public m: Tm,
        public kg: Tkg,
        public s: Ts,
        public a: TA,
        public k: TK,
        public mol: Tmol,
        public cd: Tcd,
        public times = 1) { }
    multiple<
        Vm extends number,
        Vkg extends number,
        Vs extends number,
        VA extends number,
        VK extends number,
        Vmol extends number,
        Vcd extends number>(unit: Unit<Vm, Vkg, Vs, VA, VK, Vmol, Vcd>) {
        return new Unit((this.m as number) + (unit.m as number),
            (this.kg as number) + (unit.kg as number),
            (this.s as number) + (unit.s as number),
            (this.a as number) + (unit.a as number),
            (this.k as number) + (unit.k as number),
            (this.mol as number) + (unit.mol as number),
            (this.cd as number) + (unit.cd as number),
            this.times * unit.times);
    }
    divide<Vm extends number,
        Vkg extends number,
        Vs extends number,
        VA extends number,
        VK extends number,
        Vmol extends number,
        Vcd extends number>(unit: Unit<Vm, Vkg, Vs, VA, VK, Vmol, Vcd>) {
        return new Unit((this.m as number) - (unit.m as number),
            (this.kg as number) - (unit.kg as number),
            (this.s as number) - (unit.s as number),
            (this.a as number) - (unit.a as number),
            (this.k as number) - (unit.k as number),
            (this.mol as number) - (unit.mol as number),
            (this.cd as number) - (unit.cd as number),
            this.times / unit.times);
    }
    toString() {
        let result: string[] = [];
        result.push(this.baseUnitToString("m", this.m));
        result.push(this.baseUnitToString("kg", this.kg));
        result.push(this.baseUnitToString("s", this.s));
        result.push(this.baseUnitToString("a", this.a));
        result.push(this.baseUnitToString("k", this.k));
        result.push(this.baseUnitToString("mol", this.mol));
        result.push(this.baseUnitToString("cd", this.cd));
        return result.filter(r => r).join("*");
    }
    private baseUnitToString(baseUnit: string, baseUnitNumber: number) {
        if (baseUnitNumber === 1) {
            return ` ${baseUnit} `;
        } else if (baseUnitNumber < 0) {
            return ` ${baseUnit}^(${baseUnitNumber}) `;
        } else if (baseUnitNumber > 0) {
            return ` ${baseUnit}^${baseUnitNumber} `;
        } else {
            return "";
        }
    }
}
```

#### 定义常用物理量单位

```ts
const m = new Unit<1, 0, 0, 0, 0, 0, 0>(1, 0, 0, 0, 0, 0, 0);
const s = new Unit<0, 0, 1, 0, 0, 0, 0>(0, 0, 1, 0, 0, 0, 0);
const kg = new Unit<0, 1, 0, 0, 0, 0, 0>(0, 1, 0, 0, 0, 0, 0);
const N = new Unit<1, 1, -2, 0, 0, 0, 0>(1, 1, -2, 0, 0, 0, 0);
const J = new Unit<2, 1, -2, 0, 0, 0, 0>(2, 1, -2, 0, 0, 0, 0);
const km = new Unit<1, 0, 0, 0, 0, 0, 0>(1, 0, 0, 0, 0, 0, 0, 1000);
```

#### 定义物理量

```ts
class Quantity<
    Tm extends number,
    Tkg extends number,
    Ts extends number,
    TA extends number,
    TK extends number,
    Tmol extends number,
    Tcd extends number> {
    constructor(public num: number, public unit: Unit<Tm, Tkg, Ts, TA, TK, Tmol, Tcd>) { }
    toString() {
        return (this.num * this.unit.times) + "" + this.unit.toString();
    }
    add(quantity: Quantity<Tm, Tkg, Ts, TA, TK, Tmol, Tcd>) {
        if (this.unit.times === quantity.unit.times) {
            return new Quantity(this.num + quantity.num, this.unit);
        } else if (this.unit.times > quantity.unit.times) {
            return new Quantity(this.num * this.unit.times / quantity.unit.times + quantity.num, quantity.unit);
        } else {
            return new Quantity(this.num * quantity.unit.times / this.unit.times + quantity.num, this.unit);
        }
    }
    minus(quantity: Quantity<Tm, Tkg, Ts, TA, TK, Tmol, Tcd>) {
        if (this.unit.times === quantity.unit.times) {
            return new Quantity(this.num - quantity.num, this.unit);
        } else if (this.unit.times > quantity.unit.times) {
            return new Quantity(this.num * this.unit.times / quantity.unit.times - quantity.num, quantity.unit);
        } else {
            return new Quantity(this.num * quantity.unit.times / this.unit.times - quantity.num, this.unit);
        }
    }
    multiple<Vm extends number,
        Vkg extends number,
        Vs extends number,
        VA extends number,
        VK extends number,
        Vmol extends number,
        Vcd extends number>(quantity: Quantity<Vm, Vkg, Vs, VA, VK, Vmol, Vcd>) {
        return new Quantity(this.num * quantity.num, this.unit.multiple(quantity.unit));
    }
    divide<Vm extends number,
        Vkg extends number,
        Vs extends number,
        VA extends number,
        VK extends number,
        Vmol extends number,
        Vcd extends number>(quantity: Quantity<Vm, Vkg, Vs, VA, VK, Vmol, Vcd>) {
        return new Quantity(this.num / quantity.num, this.unit.divide(quantity.unit));
    }
}
```

#### 使用

```ts
new Quantity(1, km).add(new Quantity(3, m)); // 1 km + 3 m = 1003 m
new Quantity(1, km).minus(new Quantity(3, m)); // 1 km - 3m = 997 m
new Quantity(1, km).multiple(new Quantity(10, N)); // 1 km * 10 N = 10000 m^2 * kg * s^(-2)
new Quantity(1, km).divide(new Quantity(4, s)); // 1 km / 4 s = 250 m * s^(-1)
new Quantity(1, km).add(new Quantity(3, kg)); // 编译错误, km和kg不是同一个单位，
(new Quantity(1, km).multiple(new Quantity(10, N)).add(new Quantity(2, km).multiple(new Quantity(4, N)))); // (1 km * 10 N) + (2 km * 4 N) = 18000 m^2 * kg * s^(-2)
```

#### 不足

+ js的限制，不能重载运算符
+ 虽然加减操作可以保证类型安全，乘除操作的结果的类型是`Unit<number, number, number, ...number>`，它的类型被范围扩大了，不是实际的类型，这是typescript的限制
