# ws 和 socket.io 传输数据的可靠性

### ws

对于 ws，发送数据结束时，会调用回调函数，如果存在 error，可以按照策略（次数、时间间隔）重传。

### socket.io

对于 socket.io，因为没有回调函数，所以是不知道消息的发送结果的，也不能保证传输的可靠。

这时候，可以悲观认为消息的传输很可能失败，发送前就保存起来，当客户端收到消息后，回复一个确认消息，服务端就可以确认消息传输成功了。

可以按照策略（次数、时间间隔），定时获取没有结果的消息，排出几秒内的消息后，重传。

如果网络完全断开，没有结果的消息越积越多，需要根据需求来实现消息持久化、告警、消息恢复。

### web 前端

后端的发送失败的数据可以保存在数据库、redis 中，前端可以保存在 localstorage 中。
